<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Work Report</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>


    <style>
        /* Mobile Responsive Slide Menu Styles */
        #mobileMenu {
            position: fixed;
            top: 0;
            left: -300px;
            width: 300px;
            height: 100%;
            background-color: #f8f9fa;
            transition: 0.3s;
            z-index: 1000;
            padding-top: 60px;
        }

        #mobileMenu.open {
            left: 0;
        }

        #menuOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            z-index: 999;
        }

        #menuOverlay.active {
            display: block;
        }

        #hamburgerMenu {
            display: none;
        }

        @media (max-width: 768px) {
            #hamburgerMenu {
                display: block;
                position: fixed;
                top: 15px;
                left: 15px;
                z-index: 1100;
                cursor: pointer;
            }

            .main-content {
                margin-left: 0;
            }
        }

        /* Authentication Styles */
        #authContainer {
            position: fixed;
            top: 15px;
            right: 15px;
            z-index: 1100;
        }
    </style>
    <style>

        
    .hidden {
        display: none;
    }
    .scroll-button {
    position: fixed;
    bottom: 1rem;
    right: 1rem;
    z-index: 50;
    width: 60px;  /* Increased width */
    height: 60px; /* Increased height */
    background-color: #1a1a1a; /* Darker background */
    color: white;
    border-radius: 50%; /* Circular shape */
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2); /* Added shadow */
    transition: all 0.3s ease;
}

.scroll-button:hover {
    transform: scale(1.1); /* Slight enlargement on hover */
    background-color: #333; /* Slightly lighter on hover */
}

/* Specific adjustments for up and down buttons */
#scrollUpButton, #scrollDownButton {
    font-size: 24px; /* Larger arrow text */
    font-weight: bold;
}

    /* Only change input fields to blue, exclude select elements for title */
    input[type="text"], input[type="number"], input[type="time"], textarea {
        color: #e16c29; /* Change text color to blue */
    }

    /* Exclude dropdowns (select elements) specifically for title */
    select#monthDropdown, select#yearDropdown {
        color: #000000; /* Ensure dropdown title stays black */
    }      

    /* General select element styling, if needed */
    select:not(#monthDropdown):not(#yearDropdown) {
        color: #e16c29; /* Apply blue to other select elements */
    }
    
    .day-box {
    
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1); /* Enhanced shadow */
    padding: 20px; /* Add padding for spacing */
    margin: 15px 10px; /* Add margin to create space between boxes */
    transition: all 0.3s ease; /* Smooth transition for hover effects */
    
    overflow: hidden; /* Ensures content stays within rounded corners */
}



.day-box {
    background: linear-gradient(135deg, #ffffff, #f8f9fc);
    border: 1px solid #e0e0e0;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
    padding: 20px;
    margin: 15px 10px;
    
    overflow: hidden;
    border-top: 4px solid #0563a7; /* Add a specific blue top border */
}

.day-box::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background-color: #2f6df7; /* Remove previous gradient */
    display: none; /* Hide the previous pseudo-element */
}

/* Ensure input fields and buttons have consistent styling within day-box */
.day-box input, 
.day-box select, 
.day-box button {
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    transition: all 0.2s ease;
}

.day-box input:focus, 
.day-box select:focus {
    border-color: #2f6df7;
    box-shadow: 0 0 0 3px rgba(47, 109, 247, 0.1);
}


    .hidden {
            display: none;
        }
        
        /* Reminder Modal Styles */
        
        
        #reminderContent {
            background-color: white;
            padding: 2rem;
            border-radius: 0.75rem;
            width: 90%;
            max-width: 500px;
            max-height: 80%;
            overflow-y: auto;
        }
        
        .reminder-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 0.5rem;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
        }


        .edit-pencil {
    border: 1px solid black;
    border-radius: 50%;
    padding: 5px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    width: 32px;
    height: 32px;
    background: none; /* Remove background */
    transition: transform 0.2s ease-in-out; /* Add hover animation */
}

.edit-pencil:hover {
    transform: scale(1.1); /* Slight zoom on hover */
    border-color: #ca0505; /* Change border color on hover */
}

.edit-pencil svg {
    stroke: black; /* Ensure the pencil icon is black */
    width: 16px;
    height: 16px;
}


#reminderList {
    max-height: 400px; /* Adjust height to fit around 5 reminders */
    overflow-y: auto; /* Enable vertical scrolling */
    padding-right: 10px; /* Space for scrollbar */
    scrollbar-width: thin; /* Thin scrollbar for Firefox */
    scrollbar-color: #cbd5e0 transparent; /* Colors for scrollbar */
}

/* Scrollbar styles for WebKit-based browsers */
#reminderList::-webkit-scrollbar {
    width: 8px;
}

#reminderList::-webkit-scrollbar-thumb {
    background-color: #cbd5e0; /* Scrollbar thumb color */
    border-radius: 4px; /* Rounded edges for thumb */
}

#reminderList::-webkit-scrollbar-track {
    background: transparent; /* Scrollbar track color */
}

input[type="text"],
input[type="number"],
input[type="time"],
textarea,
select {
    color: #e16c29; /* Set text color to blue */
}


.text-blue-500 {
    color: #e16c29 !important; /* Change text color to the specified orange */
    font-weight: bold; /* Optional: maintain the bold styling */
}



/* iPhone-style time picker enhancements */
.custom-time-picker {
    appearance: none; /* Remove native browser styles */
    -webkit-appearance: none;
    background-color: #ffffff;
    font-size: 1rem;
    text-align: center;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    cursor: pointer;
}

.custom-time-picker:focus {
    border-color: #2f6df7; /* Highlight border on focus */
    box-shadow: 0 0 0 4px rgba(47, 109, 247, 0.2);
    outline: none;
}



#exportTableContainer {
    opacity: 0; /* Hide from users */
    height: 0; /* Prevent visible space usage */
    overflow: hidden; /* Hide any scrolling */
    position: absolute; /* Keep it off-screen but still part of the page */
    left: -9999px;
}


#backupButton, #restoreButton {
    background-color: black;
    color: white;
    padding: 10px 20px;
    border-radius: 5px;
    font-weight: bold;
    transition: background 0.3s ease;
}

#backupButton:hover, #restoreButton:hover {
    background-color: #333; /* Slightly lighter black on hover */
}



td {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}




#dateSearchBtn {
    position: relative; /* Default position inside the rectangle box */
    transition: all 0.3s ease-in-out;
}

.fixed-date-search {
    position: fixed !important;
    bottom: 9.5rem; /* Positioned above the up-arrow button */
    right: 1rem;
    z-index: 100;
    background-color: #1a1a1a;
    color: white;
    padding: 10px;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}

.fixed-date-search:hover {
    transform: scale(1);
    background-color: #333;
}

table {
    border-collapse: collapse;
    width: 100%;
    border: 0.5px solid rgba(0, 0, 0, 0.358); /* Thinner but bold outer border */
}

th, td {
    border: 0.5px solid rgba(0, 0, 0, 0.319); /* Thinner but bold inner borders */
    padding: 8px;
    text-align: left;
}

th {
    background-color: #f2f2f2; /* Optional: Header background */
}


</style>   
</head>



    



<div class="max-w-7xl mx-auto p-4">
    <h1 class="text-2xl font-bold text-center text-black mb-6">Work Report Tracker</h1>
 
    <!-- Month and Year Selection -->
    <div class="flex justify-between items-center mb-6">
        <button id="prevMonth" class="p-2 hover:bg-gray-100 rounded-full text-lg">←</button>
        <div class="flex items-center space-x-2">
            <select id="monthDropdown" class="text-xl font-semibold p-2 rounded"></select>
            <select id="yearDropdown" class="text-xl font-semibold p-2 rounded"></select>
        </div>
        <button id="nextMonth" class="p-2 hover:bg-gray-100 rounded-full text-lg">→</button>
     </div>

     
    
    <!-- New rectangular box for buttons -->
    <div class="flex justify-center mb-6">
        <div class="flex items-center space-x-2 bg-gray-100 p-2 rounded-lg">
            <button id="reminderButton" class="p-2 hover:bg-gray-300 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/>
                    <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/>
                </svg>
            </button>
            <!-- Date Search Button -->
<button id="dateSearchBtn" class="p-2 hover:bg-gray-300 rounded-full">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="11" cy="11" r="8"/>
        <path d="m21 21-4.3-4.3"/>
    </svg>
    
</button>

<!-- Date Picker Modal -->
<div id="dateSearchModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center z-70">
    <div class="bg-white rounded-lg shadow-lg w-80 max-h-[90vh] overflow-y-auto p-4">
        <h2 class="text-lg font-bold mb-2">Select Date</h2>

        

        <!-- Week and Day Selection -->
        <div class="grid grid-cols-4 gap-2 mb-4" id="datesGrid"></div>
        
        <!-- Close Button -->
        <button id="closeDatePicker" class="w-full p-2 bg-red-500 text-white rounded">Close</button>
        <script>
            document.getElementById("closeDatePicker").addEventListener("click", function(event) {
                event.stopPropagation(); // Prevent event from closing the container
            });
            </script>
    </div>
</div>

            <button id="shareButton" class="p-2 hover:bg-gray-300 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="18" cy="5" r="3"/>
                    <circle cx="6" cy="12" r="3"/>
                    <circle cx="18" cy="19" r="3"/>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/>
                </svg>
            </button>
        </div>
    </div>

    <script>
        
        document.addEventListener("deviceready", function () {
            document.getElementById("downloadBtn").addEventListener("click", downloadFile);
        });
    
        function downloadFile() {
            var fileTransfer = new FileTransfer();
            var uri = encodeURI("https://example.com/file.pdf"); // Replace with your actual file URL
            var fileURL = cordova.file.externalRootDirectory + "Download/file.pdf";
    
            fileTransfer.download(
                uri,
                fileURL,
                function(entry) {
                    alert("Download complete: " + entry.toURL());
                },
                function(error) {
                    alert("Download failed: " + error.code);
                }
            );
        }



        window.addEventListener("scroll", () => {
        const dateSearchBtn = document.getElementById("dateSearchBtn");
        const referenceBox = document.querySelector(".flex.items-center.space-x-2.bg-gray-100"); // The rectangular box

        const rect = referenceBox.getBoundingClientRect();
        const scrollPosition = window.scrollY;

        if (scrollPosition > rect.bottom + 100) {
            dateSearchBtn.classList.add("fixed-date-search"); // Move to bottom-right above up arrow
        } else {
            dateSearchBtn.classList.remove("fixed-date-search"); // Stay in the rectangle
        }
    });
    </script>

    
    



    
    <script>
        







        document.getElementById("closeDatePicker").addEventListener("click", function() {
    document.getElementById("dateSearchModal").classList.add("hidden"); // Remove or comment out this line
});

        document.addEventListener("DOMContentLoaded", function () {
    const shareButton = document.getElementById("shareButton");

    if (shareButton) {
        shareButton.addEventListener("click", function () {
            openShareModal();
        });
    } else {
        console.error("Share button not found!");
    }
});

function openShareModal() {
    let shareModal = document.getElementById("shareExportModal");

    // If modal doesn't exist, create it
    if (!shareModal) {
        shareModal = document.createElement("div");
        shareModal.id = "shareExportModal";
        shareModal.className = "fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center z-50";
        shareModal.innerHTML = `
            <div class="bg-white rounded-lg shadow-lg w-11/12 max-w-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">Share Options</h2>
                    <button id="closeShareModal" class="text-gray-500 hover:text-gray-700">
                        ✖
                    </button>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <button id="shareTextBtn" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                        Share as Text
                    </button>
                    <button id="exportDataBtn" class="p-3 bg-green-500 text-white rounded-lg hover:bg-green-600">
                        Export Data as PDF
                    </button>
                    <button id="exportSelectedMonthBtn" class="p-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
    Export Selected Month
</button>

                </div>
            </div>
        `;
        document.body.appendChild(shareModal);

        // Close modal functionality
        document.getElementById("closeShareModal").addEventListener("click", function () {
            document.body.removeChild(shareModal);
        });

        // Event Listeners
        document.getElementById("exportDataBtn").addEventListener("click", generatePDF);
        document.getElementById("shareTextBtn").addEventListener("click", shareText);
    }
}

        // Replace the existing share button click event handler with this new one
    document.getElementById('shareButton').addEventListener('click', function() {
        // Create the popup modal for sharing and exporting
        const shareModal = document.createElement('div');
        shareModal.id = 'shareExportModal';
        shareModal.className = 'fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center z-100';
        
        // Generate content for the popup
        const monthName = months[currentDate.getMonth()];
        const year = currentDate.getFullYear();
        const totalOtHours = document.getElementById("totalOtHours").textContent;
        
        // Create the summary text
        const summaryText = `Work Summary Report for ${monthName} ${year}:\n` +
            `- Regular Leaves: ${document.getElementById("regularLeaves").textContent}\n` +
            `- Special Days: ${document.getElementById("specialDays").textContent}\n` +
            `- Weekend Leaves: ${document.getElementById("weekendLeaveDays").textContent}\n` +
            `- Total OT Hours: ${totalOtHours} hours`;
        
        // Popup content
        shareModal.innerHTML = `
            <div class="bg-white rounded-lg shadow-lg w-11/12 max-w-md p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">Share Options</h2>
                    <button id="closeShareModal" class="text-gray-500 hover:text-gray-700">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="18" y1="6" x2="6" y2="18"></line>
                            <line x1="6" y1="6" x2="18" y2="18"></line>
                        </svg>
                    </button>
                </div>
                
                <div class="mb-4 p-4 bg-gray-100 rounded-lg">
                    <p class="font-bold mb-2">Summary</p>
                    <pre class="whitespace-pre-wrap text-sm">${summaryText}</pre>
                </div>
                
                <div class="grid grid-cols-1 gap-4">
                    <button id="shareTextBtn" class="p-3 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center justify-center">
                        <svg class="mr-2" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="18" cy="5" r="3"></circle>
                            <circle cx="6" cy="12" r="3"></circle>
                            <circle cx="18" cy="19" r="3"></circle>
                            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                        </svg>
                        Share as Text
                    </button>
                    
                    <button id="exportDataBtn" class="p-3 bg-green-500 text-white rounded-lg hover:bg-green-600 flex items-center justify-center">
                        <svg class="mr-2" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        Export Data
                    </button>

                    
                </div>
            </div>
        `;
        
        // Append modal to the body
        document.body.appendChild(shareModal);
        
        // Close modal functionality
        document.getElementById('closeShareModal').addEventListener('click', function() {
            document.body.removeChild(shareModal);
        });
        
        // Share as text functionality
        document.getElementById('shareTextBtn').addEventListener('click', function() {
    const summaryText = `Work Summary Report for ${monthName} ${year}:\n` +
        `- Regular Leaves: ${document.getElementById("regularLeaves").textContent}\n` +
        `- Special Days: ${document.getElementById("specialDays").textContent}\n` +
        `- Weekend Leaves: ${document.getElementById("weekendLeaveDays").textContent}\n` +
        `- Total OT Hours: ${document.getElementById("totalOtHours").textContent} hours`;

    navigator.clipboard.writeText(summaryText).then(() => {
        alert("Summary copied to clipboard!");
    }).catch(err => {
        console.error("Failed to copy text: ", err);
        alert("Failed to copy. Please try again.");
    });
});

        
        // Export data functionality
        document.getElementById('exportDataBtn').addEventListener('click', function() {
            
            
            // Create export modal with detailed table
            const exportModal = document.createElement('div');
            exportModal.id = 'dataExportModal';
            exportModal.className = 'fixed inset-0 bg-gray-800 bg-opacity-80 flex justify-center items-center z-110';
    exportModal.style.display = 'flex';
    exportModal.style.alignItems = 'center';
    exportModal.style.justifyContent = 'center';
    exportModal.style.height = '100vh';
    exportModal.style.width = '100vw';
    exportModal.style.overflowY = 'auto'; // Ensures modal is scrollable
    
    
    
    
            
            // Generate table HTML with all month data
            let tableRows = '';
    const daysInMonth = getDaysInMonth(currentDate.getFullYear(), currentDate.getMonth());

    for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = `${currentDate.getFullYear()}-${currentDate.getMonth()}-${day}`;
        const dayData = workData[dateKey] || {};
        const dayDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
const formattedDate = `${String(day).padStart(2, '0')}.${String(currentDate.getMonth() + 1).padStart(2, '0')}.${currentDate.getFullYear()}`;

let specialDayClass = "";
    if (dayData.specialDays === "Poya Day" || dayData.specialDays === "Public Holiday") {
        specialDayClass = 'style="color: green; font-weight: bold;"';
    }


    // Determine the correct leave reason value with custom reason details
let leaveReasonText = '-';
if (dayData.leaveReason) {
    if (dayData.leaveReason === "Custom Reason") {
         leaveReasonText = dayData.customReasonDetails ? dayData.customReasonDetails : "Custom Reason";
    } else if (dayData.leaveReason === "Own Leave") {
         leaveReasonText = dayData.leaveReasonDetails ? dayData.leaveReasonDetails : "Own Leave";
    } else {
         leaveReasonText = dayData.leaveReason;
    }
}


    

    


        tableRows += `
            <tr class="border-b">
        <td class="p-2 border-r ${isWeekend(currentDate.getFullYear(), currentDate.getMonth(), day) ? 'text-red-500 font-bold' : ''}">${formattedDate}</td>
        <td class="p-2 border-r">${dayData.inTime || '-'}</td>
        <td class="p-2 border-r">${dayData.outTime || '-'}</td>
        <td class="p-2 border-r">${dayData.movementOut || '-'}</td>
        <td class="p-2 border-r">${dayData.movementIn || '-'}</td>
        <td class="p-2 border-r">${dayData.teamMembers || '-'}</td>
        <td class="p-2 border-r">${dayData.workLocation || '-'}</td>
        <td class="p-2 border-r">${dayData.vehicleNumber || '-'}</td>
        <td class="p-2 border-r">${dayData.km || '-'}</td>
        <td class="p-2 border-r" ${specialDayClass}>${dayData.specialDays || '-'}</td>
        <td class="p-2 border-r" style="${dayData.leaveStatus === 'Yes' ? 'color: #1E90FF; font-weight: bold;' : ''}">
            ${dayData.leaveStatus || '-'}
        </td>
        <td class="p-2 border-r">${leaveReasonText}</td>
    </tr>
        `;
    }

    exportModal.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg w-11/12 max-w-4xl p-6 flex flex-col items-center justify-center">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Export Data: ${months[currentDate.getMonth()]} ${currentDate.getFullYear()}</h2>
                <button id="closeExportModal" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            
            
            <div id="exportTableContainer" class="overflow-auto mb-4">
   <!-- New Heading Section -->
<div class="flex flex-col items-center mb-4">
    <h2 class="text-xl font-bold">Work Data Sheet</h2>
    <p class="text-md font-semibold">Name: T.Jeyaraman | Service No: 016696</p>
    <h3 class="text-lg font-semibold" id="exportMonthYear"></h3>
</div>


                <table class="min-w-full bg-white border">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="p-2 border-r">Day</th>
                
                            <th class="p-2 border-r">In Time</th>
                            <th class="p-2 border-r">Out Time</th>
                            <th class="p-2 border-r">Movement Out Time</th>
                            <th class="p-2 border-r">Movement In Time</th>
                            <th class="p-2 border-r">Team Members</th>
                            <th class="p-2 border-r">Work Location</th>
                            <th class="p-2 border-r">Vehicle Number</th>
                            <th class="p-2 border-r">KM Reading</th>
                        
                            <th class="p-2 border-r">Present Special Day</th>
                            <th class="p-2 border-r">Leave Status</th>
                            <th class="p-2 border-r">Leave Reason</th>
                            
                            
                        </tr>
                    </thead>
                    <tbody>
                        ${tableRows}
                    </tbody>
                </table>
                
            </div>

             <!-- Save as Image Button (Added Here) -->
        <div class="flex justify-center mt-4 sticky bottom-0 bg-white p-4 shadow-lg w-full">
            <button id="saveAsPdfBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600">
                Save as Pdf
            </button>
        </div>
    </div>
    





            `;
            
            // Append export modal to the body
            document.body.appendChild(exportModal);
            document.getElementById('saveAsPdfBtn').addEventListener('click', function() {
    if (typeof html2canvas === 'undefined') {
        var script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
        script.onload = loadJsPDF;
        document.head.appendChild(script);
    } else {
        loadJsPDF();
    }
});

function updateExportTableHeader() {
    const monthNames = [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
    ];
    
    const selectedMonth = currentDate.getMonth();
    const selectedYear = currentDate.getFullYear();
    
    document.getElementById("exportMonthYear").textContent = `${monthNames[selectedMonth]} ${selectedYear}`;
}

// Call this function when the export table is displayed
updateExportTableHeader();




function loadJsPDF() {
    if (typeof jsPDF === 'undefined') {
        var script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js';
        script.onload = generateTablePDF;
        document.head.appendChild(script);
    } else {
        generateTablePDF();
    }
}

function generateTablePDF() {
    const { jsPDF } = window.jspdf;
    const tableContainer = document.getElementById('exportTableContainer');

    if (!tableContainer) {
        alert("Error: Table not found.");
        return;
    }

    // Make table visible before capture
    tableContainer.style.opacity = '1';
    tableContainer.style.height = 'auto';
    tableContainer.style.overflow = 'visible';
    tableContainer.style.position = 'relative';

    // Reduce font size and padding for mobile screens
    if (window.innerWidth < 778) {
        document.querySelectorAll("#exportTableContainer th, #exportTableContainer td").forEach(el => {
            el.style.padding = "4px";  
            el.style.fontSize = "10px"; 
        });
    }

    html2canvas(tableContainer, {
        scale: 3,  // High resolution
        useCORS: true,
        scrollX: 0,
        scrollY: 0,
        backgroundColor: '#FFFFFF' // Keeps background color
    }).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pdf = new jsPDF({
            orientation: 'portrait',  // Keep A4 portrait format
            unit: 'mm',
            format: 'a4'
        });

        const pageWidth = 210;  // A4 width in mm (portrait)
        const pageHeight = 297; // A4 height in mm (portrait)
        const imgWidth = pageWidth - 10; // Leave some padding
        const imgHeight = (canvas.height * imgWidth) / canvas.width; // Scale height proportionally

        // If the table is too tall, scale it down to fit within A4
        if (imgHeight > pageHeight - 20) {
            const scaleFactor = (pageHeight - 20) / imgHeight;
            pdf.addImage(imgData, 'PNG', 8, 10, imgWidth * scaleFactor, imgHeight * scaleFactor);
        } else {
            pdf.addImage(imgData, 'PNG', 5, 10, imgWidth, imgHeight);
        }

        pdf.save('Work_Report_A4.pdf');

        // Hide the table again after capturing
        tableContainer.style.opacity = '0';
        tableContainer.style.height = '0';
        tableContainer.style.overflow = 'hidden';
        tableContainer.style.position = 'absolute';
        tableContainer.style.left = '-9999px';
    }).catch(err => {
        console.error("html2canvas error:", err);
        alert("Failed to save PDF.");
    });
}





document.addEventListener("deviceready", function() {
    var permissions = cordova.plugins.permissions;

    permissions.requestPermission(permissions.WRITE_EXTERNAL_STORAGE, function(status) {
        if (!status.hasPermission) {
            alert("Storage permission denied! Please enable storage access.");
        }
    }, function() {
        alert("Permission request failed.");
    });
}, false);


function savePDF(pdfData) {
    var fileName = "MyDocument.pdf";
    var filePath = cordova.file.externalRootDirectory + "Download/" + fileName;

    window.resolveLocalFileSystemURL(cordova.file.externalRootDirectory, function(dir) {
        dir.getFile("Download/" + fileName, { create: true, exclusive: false }, function(fileEntry) {
            fileEntry.createWriter(function(fileWriter) {
                var dataObj = new Blob([pdfData], { type: "application/pdf" });

                fileWriter.write(dataObj);
                fileWriter.onwriteend = function() {
                    alert("PDF saved successfully: " + filePath);
                };
                fileWriter.onerror = function(e) {
                    alert("Failed to write file: " + e.toString());
                };
            });
        }, function(error) {
            alert("Error creating file: " + error.code);
        });
    });
}



function openPDF() {
    var filePath = cordova.file.externalRootDirectory + "Download/MyDocument.pdf";

    cordova.plugins.fileOpener2.open(
        filePath,
        "application/pdf",
        {
            error: function(e) {
                alert("Error opening PDF: " + JSON.stringify(e));
            },
            success: function() {
                console.log("PDF opened successfully");
            }
        }
    );
}









            
            // Close export modal functionality
            document.getElementById('closeExportModal').addEventListener('click', function() {
                document.body.removeChild(exportModal);
            });
            
            



            
            
        });
    });
    
    document.getElementById('saveAsImageBtn').addEventListener('click', function() {
    if (typeof html2canvas === 'undefined') {
        var script = document.createElement('script');
        script.src = 'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js';
        script.onload = captureFullTableAsImage;
        document.head.appendChild(script);
    } else {
        captureFullTableAsImage();
    }
});

function captureFullTableAsImage() {
    const element = document.body; // Capture the full page including all table colors
    html2canvas(element, {
        scrollX: 0,
        scrollY: 0,
        useCORS: true
    }).then(canvas => {
        const link = document.createElement('a');
        link.href = canvas.toDataURL('image/png');
        link.download = 'Work_Report_Full_Page.png';
        link.click();
    });
}


    





    
    
    </script>
    

    <!-- New alert box for reminders -->
<div id="reminderAlertBox" class="hidden bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-4 rounded-md mt-4">
    <p id="reminderAlertMessage" class="text-sm"></p>
</div>
    
    <!-- Rest of the existing HTML remains the same -->
 </div>

<!-- Rest of the existing HTML remains the same -->

        <!-- Reminder Modal -->
        <!-- Reminder Modal -->
<div id="reminderModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center z-100">
    <div id="reminderContent" class="bg-white rounded-lg shadow-lg w-11/12 max-w-md p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-bold">Set Your Reminder</h2>
            
            <div class="flex items-center space-x-2">
                <!-- Close button -->
                
                
                <button id="addReminderBtn" class="bg-green-500 text-white rounded-full w-10 h-10 flex items-center justify-center">
                    +
                </button>
            </div>
        </div>
        <div id="reminderList"></div>
    </div>
</div>


        

<!-- Add at bottom of body -->
<div id="dateSearchModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center z-70">
    <div class="bg-white rounded-lg shadow-lg w-64 max-h-96 overflow-y-auto p-4">
        <div class="grid grid-cols-4 gap-2" id="datesGrid"></div>
    </div>
</div>

        <!-- Daily Entries -->
        <div id="daysContainer" class="space-y-6"></div>

        <!-- Monthly Summary -->
       <div class="mt-8 p-6 bg-white rounded-lg shadow-lg">
    <h2 class="text-xl font-bold mb-4">Monthly Summary</h2>
    <div>
        <p>Leave Days (Regular): <span id="regularLeaves">0</span></p>
        <p>Leave Days (Poya/Public): <span id="specialDays">0</span></p>
        <p>Leave Days (Saturday/Sunday): <span id="weekendLeaveDays">0</span></p>
        <hr class="border-t-3.5 border-black my-4">
        <p>Weekend OT Hours: <span id="weekendOtHours">0</span> hours</p>
        <p>Sat/Sun OT Hours: <span id="satSunOtHours">0</span> hours</p>
        <p>Poya/Public OT Hours: <span id="poyaPublicOtHours">0</span> hours</p>
        <p class="text-blue-500 font-semibold">Total OT Hours: <span id="totalOtHours">0</span> hours</p>
    </div>
    <button id="clearAllButton" class="mt-4 p-2 bg-red-100 text-red-600 rounded hover:bg-red-200 w-full">
        Clear All Month Data
    </button>

    <div class="sticky bottom-0 left-0 w-full bg-white shadow-md p-4 flex justify-center gap-4">
        <button id="backupButton" class="p-2 bg-blue-500 text-white rounded hover:bg-blue-600">
            Backup Data
        </button>
        <button id="restoreButton" class="p-2 bg-green-500 text-white rounded hover:bg-green-600">
            Restore Data
        </button>
    </div>
    <input type="file" id="restoreFileInput" class="hidden" accept=".json">
    

    

    
</div>
        </div>

        <!-- Scroll Buttons -->
        <div class="fixed bottom-4 right-4 flex flex-col gap-2">
            <button id="scrollUpButton" class="p-2 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700 hidden">
                ↑
            </button>
            <button id="scrollDownButton" class="p-2 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700">
                ↓
            </button>
        </div>

    <script>

        // Backup Data Functionality
document.getElementById("backupButton").addEventListener("click", function () {
    const selectedMonth = document.getElementById("monthDropdown").value;
    const selectedYear = document.getElementById("yearDropdown").value;
    const monthPrefix = `${selectedYear}-${selectedMonth}`;

    let monthData = {};
    Object.keys(workData).forEach((key) => {
        if (key.startsWith(monthPrefix)) {
            monthData[key] = workData[key];
        }
    });

    if (Object.keys(monthData).length === 0) {
        alert("No data found for this month to backup.");
        return;
    }

    const blob = new Blob([JSON.stringify(monthData, null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = `WorkData_${selectedYear}_${parseInt(selectedMonth) + 1}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    alert("Backup downloaded successfully.");
});

// Restore Data Functionality
document.getElementById("restoreButton").addEventListener("click", function () {
    document.getElementById("restoreFileInput").click();
});

document.getElementById("restoreFileInput").addEventListener("change", function (event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function (e) {
        try {
            const restoredData = JSON.parse(e.target.result);
            Object.assign(workData, restoredData);
            localStorage.setItem("workData", JSON.stringify(workData));
            calculateSummary();
            renderDays();
            alert("Backup restored successfully.");
        } catch (error) {
            alert("Error restoring backup. Please select a valid file.");
        }
    };
    reader.readAsText(file);
});















        // State
        let currentDate = new Date();
        let workData = JSON.parse(localStorage.getItem("workData")) || {};

        const months = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];

        // DOM Elements
        const monthDropdown = document.getElementById("monthDropdown");
        const yearDropdown = document.getElementById("yearDropdown");
        const daysContainer = document.getElementById("daysContainer");
        const regularLeavesEl = document.getElementById("regularLeaves");
        const specialDaysEl = document.getElementById("specialDays");
        const otHoursEl = document.getElementById("otHours");
        const scrollButton = document.getElementById("scrollButton");
        const clearAllButton = document.getElementById("clearAllButton");

        // Utilities
        const getDaysInMonth = (year, month) => new Date(year, month + 1, 0).getDate();
        const formatDayDisplay = (day, month, year, weekday) => `${weekday} : ${months[month]} ${day} : ${year}`;
        const isWeekend = (year, month, day) => {
            const date = new Date(year, month, day);
            return date.getDay() === 0 || date.getDay() === 6; // Sunday (0) or Saturday (6)
        };

        // Convert Time to 24-Hour Format
        function convertTo24Hour(time, isPM = false) {
            if (!time) return null;
            let [hours, minutes] = time.split(":").map(Number);
            if (isPM && hours < 12) hours += 12;
            if (!isPM && hours === 12) hours = 0;
            return `${hours.toString().padStart(2, "0")}:${minutes.toString().padStart(2, "0")}`;
        }

        // Calculate Hours Difference
        function calculateHoursDifference(inTime, outTime) {
            if (!inTime || !outTime) return 0;
            const [inHours, inMinutes] = inTime.split(":").map(Number);
            const [outHours, outMinutes] = outTime.split(":").map(Number);

            const inTimeMinutes = inHours * 60 + inMinutes;
            const outTimeMinutes = outHours * 60 + outMinutes;

            const diffMinutes = outTimeMinutes - inTimeMinutes;
            return diffMinutes / 60; // Convert minutes to hours
        }

        // Populate Month and Year Dropdowns
        function populateDropdowns() {
            monthDropdown.innerHTML = months
                .map((month, index) => `<option value="${index}" ${index === currentDate.getMonth() ? "selected" : ""}>${month}</option>`)
                .join("");

            const currentYear = currentDate.getFullYear();
            yearDropdown.innerHTML = Array.from({ length: 11 }, (_, i) => currentYear - 5 + i)
                .map(year => `<option value="${year}" ${year === currentYear ? "selected" : ""}>${year}</option>`)
                .join("");
        }

        // Render Days
        function renderDays() {
    daysContainer.innerHTML = "";
    const daysInMonth = getDaysInMonth(currentDate.getFullYear(), currentDate.getMonth());

    for (let day = 1; day <= daysInMonth; day++) {
        const dateKey = `${currentDate.getFullYear()}-${currentDate.getMonth()}-${day}`;
        let dayData = workData[dateKey] || {};

// Set default leaveStatus to "No" if it's not defined
if (dayData.leaveStatus === undefined || dayData.leaveStatus === "") {
    dayData.leaveStatus = "No";
    workData[dateKey] = dayData;
    localStorage.setItem("workData", JSON.stringify(workData));
}

        const dayDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
        const dayName = dayDate.toLocaleDateString("en-US", { weekday: "long" });
        const isWeekendDay = isWeekend(currentDate.getFullYear(), currentDate.getMonth(), day);
        

        const formattedDay = formatDayDisplay(day, currentDate.getMonth(), currentDate.getFullYear(), dayName);

        const card = document.createElement("div");
card.className = "day-box"; /* Apply the premium style class */
card.setAttribute('data-day', day);


        card.innerHTML = `
            <div class="space-y-4">
                <div class="text-lg font-semibold ${isWeekendDay ? 'text-red-600' : 'text-black'}">
                    ${formattedDay}
                </div>
                <div class="grid grid-cols-1 gap-4">
                    ${createInputField("In Time", "inTime", dayData.inTime || "", "Enter in time (AM)", dateKey, "time")}
                ${createInputField("Out Time", "outTime", dayData.outTime || "", "Enter out time (PM)", dateKey, "time")}
                ${createInputField("Movement Out Time", "movementOut", dayData.movementOut || "", "Enter movement out time", dateKey, "time")}
                ${createInputField("Movement In Time", "movementIn", dayData.movementIn || "", "Enter movement in time", dateKey, "time")}
                ${createInputField("Team Members", "teamMembers", dayData.teamMembers || "", "Enter team members", dateKey, "text")}
                ${createInputField("Work Location", "workLocation", dayData.workLocation || "", "Enter work location", dateKey, "text")}
                ${createInputField("Vehicle Number", "vehicleNumber", dayData.vehicleNumber || "", "Enter vehicle number", dateKey, "text")}
                ${createInputField("KM", "km", dayData.km || "", "Enter kilometers", dateKey, "number")}
                ${createDropdown("Present On specialDays", "specialDays", ["", "Poya Day", "Public Holiday"], dayData.specialDays || "", "Select special day", dateKey)}
                ${createDropdown("Leave Status", "leaveStatus", ["", "Yes", "No"], dayData.leaveStatus || "", "Select leave status", dateKey)}
${dayData.leaveStatus === "Yes" ? 
    createDropdown("Leave Reason", "leaveReason", 
        isWeekend(currentDate.getFullYear(), currentDate.getMonth(), day)
            ? ["", "Poya Day", "Public Holiday", "Custom Reason", "Own Leave", "Normal Leave Day"]
            : ["", "Poya Day", "Public Holiday", "Custom Reason", "Own Leave"],
        dayData.leaveReason || "", "Select leave reason", dateKey)
    : ""}


                ${dayData.leaveStatus === "Yes" && dayData.leaveReason === "Custom Reason" ? createInputField("Custom Reason Details", "customReasonDetails", dayData.customReasonDetails || "", "Enter custom reason details", dateKey, "text") : ""}
                ${dayData.leaveStatus === "Yes" && dayData.leaveReason === "Own Leave" ? createInputField("Leave Reason Details", "leaveReasonText", dayData.leaveReasonText || "", "Enter leave reason details", dateKey, "text") : ""}
                
                
                </div>
                <button 
            onclick="clearDayData('${dateKey}')"
            class="mt-4 p-2 bg-black bg-opacity-84 text-white rounded hover:bg-black hover:bg-opacity-75">
            Clear Day Data
        </button>

            </div>
         `;

        daysContainer.appendChild(card);
    }
}




        // Create Input Field with Placeholder
        function createInputField(label, field, value, placeholder, dateKey, type = "text") {
    if (type === "time") {
        return `
            <div class="flex flex-col">
                <label class="font-medium mb-1">${label}</label>
                <input 
                    type="time" 
                    class="p-2 border rounded custom-time-picker"
                    placeholder="${placeholder}"
                    value="${value}" 
                    onchange="updateWorkData('${dateKey}', '${field}', this.value)"
                />
            </div>
        `;
    }
    return `
        <div class="flex flex-col">
            <label class="font-medium mb-1">${label}</label>
            <input 
                type="${type}" 
                class="p-2 border rounded"
                placeholder="${placeholder}"
                value="${value}" 
                onchange="updateWorkData('${dateKey}', '${field}', this.value)"
            />
        </div>
    `;
}

function openTimePicker(field, dateKey) {
    // Get the time input associated with the button
    const timeInput = document.querySelector(`[onchange="updateWorkData('${dateKey}', '${field}', this.value)"]`);
    if (timeInput) {
        // Programmatically focus or open the input
        timeInput.focus();
    }
}



        // Create Dropdown
        function createDropdown(label, field, options, value, placeholder, dateKey) {
    const dateParts = dateKey.split("-");
    const day = parseInt(dateParts[2], 10);
    const isWeekendDay = isWeekend(currentDate.getFullYear(), currentDate.getMonth(), day);
    

    // Modified options for weekend days
    let filteredOptions;
    if (field === "leaveStatus") {
        if (isWeekendDay) {
            filteredOptions = ["", "Yes", "No", ]; // Changed "Normal Leave Day" to "Normal Day" for weekends
        } else {
            filteredOptions = ["", "Yes", "No"]; // Weekdays don't show the Normal Day option
        }
    } else {
        filteredOptions = options;
    }

    return `
        <div class="flex flex-col">
            <label class="font-medium mb-1">${label}</label>
            <select 
                class="p-2 border rounded"
                onchange="updateWorkData('${dateKey}', '${field}', this.value)">
                <option value="" ${value === "" ? "selected" : ""}>${placeholder}</option>
                ${filteredOptions.map(opt => `<option value="${opt}" ${value === opt ? "selected" : ""}>${opt}</option>`).join("")}
            </select>
        </div>
    `;
}


// Reminder Functionality
const reminderButton = document.getElementById('reminderButton');
const reminderModal = document.getElementById('reminderModal');
        const addReminderBtn = document.getElementById('addReminderBtn');
        const reminderList = document.getElementById('reminderList');
        
        

        // Reminder Categories
        const reminderCategories = [
            'Wedding', 
            'Nobility Ceremony', 
            'Birthday', 
            'House Warming Ceremony', 
            'Other'
        ];

        

        // Load existing reminders from localStorage
        let reminders = JSON.parse(localStorage.getItem('reminders')) || [];

        // Render Reminders
function renderReminders() {
    reminderList.innerHTML = '';
    reminders.forEach((reminder, index) => {
        const reminderItem = document.createElement('div');
        reminderItem.className = 'reminder-item';
        reminderItem.innerHTML = `
    <div>
        <p><strong>Category:</strong> ${reminder.category}</p>
        ${reminder.category === 'Other' ? `<p><strong>Custom Details:</strong> ${reminder.customDetails}</p>` : ''}
        <p><strong>Date:</strong> ${reminder.date}</p>
    </div>
    <div class="flex space-x-2">
        <button onclick="editReminder(${index})" class="edit-pencil">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 20h9"/>
                <path d="M16.5 3.5a2.121 2.121 0 1 1 3 3L7 19l-4 1 1-4 12.5-12.5z"/>
            </svg>
        </button>
        <button onclick="removeReminder(${index})" class="bg-red-500 text-white px-2 py-1 rounded">
            Remove
        </button>
    </div>
`;

        reminderList.appendChild(reminderItem);
    });
}

(function () {
    // Reminder Alert Box
    const reminderAlertBox = document.getElementById('reminderAlertBox');
    const reminderAlertMessage = document.getElementById('reminderAlertMessage');

    function checkUpcomingReminders() {
    const today = new Date();
    let alertMessages = [];
    let updatedReminders = [];

    reminders.forEach(reminder => {
        const reminderDate = new Date(reminder.date);
        const timeDiff = reminderDate.getTime() - today.getTime();
        const daysDiff = Math.ceil(timeDiff / (1000 * 3600 * 24));

        if (daysDiff === 2) { 
            // Show alert if the reminder is 2 days away
            alertMessages.push(`Upcoming ${reminder.category} on ${reminder.date}`);
        }

        // Keep reminders that are not outdated
        if (daysDiff >= 0) {
            updatedReminders.push(reminder);
        }
    });
    

    


     
    


    // Update the reminders array with only upcoming reminders
    reminders = updatedReminders;
    localStorage.setItem('reminders', JSON.stringify(reminders)); // Save updated reminders

    // Display the alert message in the box
    if (alertMessages.length > 0) {
        reminderAlertMessage.innerHTML = alertMessages.join('<br>');
        reminderAlertBox.classList.remove('hidden');
    } else {
        reminderAlertBox.classList.add('hidden');
    }
}


    // Run reminder check on page load
    checkUpcomingReminders();
})();


// Edit Reminder Functionality
function editReminder(index) {
    const reminder = reminders[index];
    const categorySelect = document.createElement('select');
    categorySelect.className = 'w-full p-2 border rounded mb-2';
    reminderCategories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        if (category === reminder.category) option.selected = true;
        categorySelect.appendChild(option);
    });

    const dateInput = document.createElement('input');
    dateInput.type = 'date';
    dateInput.className = 'w-full p-2 border rounded mb-2';
    dateInput.value = reminder.date;

    const customDetailsInput = document.createElement('input');
    customDetailsInput.type = 'text';
    customDetailsInput.placeholder = 'Custom Reminder Details';
    customDetailsInput.className = 'w-full p-2 border rounded mb-2';
    customDetailsInput.value = reminder.customDetails || '';
    customDetailsInput.classList.toggle('hidden', reminder.category !== 'Other');

    categorySelect.addEventListener('change', (e) => {
        customDetailsInput.classList.toggle('hidden', e.target.value !== 'Other');
    });

    const saveButton = document.createElement('button');
    saveButton.textContent = 'Save Changes';
    saveButton.className = 'bg-green-500 text-white px-4 py-2 rounded w-full';
    saveButton.onclick = () => {
        reminders[index] = {
            category: categorySelect.value,
            date: dateInput.value,
            customDetails: categorySelect.value === 'Other' ? customDetailsInput.value : ''
        };
        localStorage.setItem('reminders', JSON.stringify(reminders));
        renderReminders();
    };

    const container = document.createElement('div');
    container.appendChild(categorySelect);
    container.appendChild(dateInput);
    container.appendChild(customDetailsInput);
    container.appendChild(saveButton);

    reminderList.innerHTML = '';
    reminderList.appendChild(container);
}


        

        

        // Add Reminder
        function addReminder() {
            const categorySelect = document.createElement('select');
            categorySelect.className = 'w-full p-2 border rounded mb-2';
            reminderCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                categorySelect.appendChild(option);
            });

            const dateInput = document.createElement('input');
            dateInput.type = 'date';
            dateInput.className = 'w-full p-2 border rounded mb-2';

            const customDetailsInput = document.createElement('input');
            customDetailsInput.type = 'text';
            customDetailsInput.placeholder = 'Custom Reminder Details';
            customDetailsInput.className = 'w-full p-2 border rounded mb-2 hidden';

            categorySelect.addEventListener('change', (e) => {
                customDetailsInput.classList.toggle('hidden', e.target.value !== 'Other');
            });

            const saveButton = document.createElement('button');
            saveButton.textContent = 'Save Reminder';
            saveButton.className = 'bg-blue-500 text-white px-4 py-2 rounded w-full';
            saveButton.onclick = () => {
                const reminder = {
                    category: categorySelect.value,
                    date: dateInput.value,
                    customDetails: categorySelect.value === 'Other' ? customDetailsInput.value : ''
                };
                reminders.push(reminder);
                localStorage.setItem('reminders', JSON.stringify(reminders));
                renderReminders();
            };

            const container = document.createElement('div');
            container.appendChild(categorySelect);
            container.appendChild(dateInput);
            container.appendChild(customDetailsInput);
            container.appendChild(saveButton);

            reminderList.appendChild(container);
        }

        



        // Remove Reminder
        function removeReminder(index) {
            reminders.splice(index, 1);
            localStorage.setItem('reminders', JSON.stringify(reminders));
            renderReminders();
        }

        // Toggle Reminder Modal
        reminderButton.addEventListener('click', () => {
            reminderModal.classList.remove('hidden');
            renderReminders();
        });

        // Close Reminder Modal when clicking outside
        reminderModal.addEventListener('click', (e) => {
            if (e.target === reminderModal) {
                reminderModal.classList.add('hidden');
            }
        });

        

        // Add Reminder Button
        addReminderBtn.addEventListener('click', addReminder);

        // Check for upcoming reminders on page load
        function checkUpcomingReminders() {
            const today = new Date();
            reminders.forEach(reminder => {
                const reminderDate = new Date(reminder.date);
                const timeDiff = reminderDate.getTime() - today.getTime();
                const daysDiff = timeDiff / (1000 * 3600 * 24);

                
            });
        }

        // Run reminder check on page load
        checkUpcomingReminders();
 


        // Update Work Data
        function updateWorkData(dateKey, field, value) {
            workData[dateKey] = workData[dateKey] || {};
            workData[dateKey][field] = value;
            localStorage.setItem("workData", JSON.stringify(workData));
            calculateSummary();
            renderDays();
        }

        function scrollToCurrentDateBox() {
    const today = new Date();
    const currentDay = today.getDate();
    const dayElement = document.querySelector(`[data-day="${currentDay}"]`);
    
    if (dayElement) {
        dayElement.scrollIntoView({ behavior: 'smooth' });
    }
}

// Add this to the initial render section
populateDropdowns();
calculateSummary();
renderDays();
scrollToCurrentDateBox(); // New line to automatically scroll to current date


        

        // Clear Day Data
function clearDayData(dateKey) {
    const modal = document.getElementById("confirmationModal");
    const confirmButton = document.getElementById("confirmButton");
    const cancelButton = document.getElementById("cancelButton");
    

    // Show the modal
    modal.classList.remove("hidden");

    // Handle confirm action
    confirmButton.onclick = () => {
        delete workData[dateKey];
        localStorage.setItem("workData", JSON.stringify(workData));
        calculateSummary();
        renderDays();
        modal.classList.add("hidden"); // Hide the modal after clearing
    };

    // Handle cancel action
    cancelButton.onclick = () => {
        modal.classList.add("hidden"); // Hide the modal without clearing
    };
}

        // Calculate Monthly Summary
        function calculateSummary() {
    const monthPrefix = `${currentDate.getFullYear()}-${currentDate.getMonth()}`;
    let regularLeaves = 0;
    let specialDays = 0;
    let weekendLeaveDays = 0;
    let weekendOtHours = 0;
    let satSunOtHours = 0;
    let poyaPublicOtHours = 0;

    Object.entries(workData).forEach(([key, data]) => {
        if (key.startsWith(monthPrefix)) {
            const dateParts = key.split("-");
            const day = parseInt(dateParts[2], 10);
            const isWeekendDay = isWeekend(currentDate.getFullYear(), currentDate.getMonth(), day);
            const isSpecialDay = data.specialDays === "Poya Day" || data.specialDays === "Public Holiday";

            const inTime = convertTo24Hour(data.inTime);
            const outTime = convertTo24Hour(data.outTime, true);
            const workingHours = calculateHoursDifference(inTime, outTime);

            if (isSpecialDay) {
                poyaPublicOtHours += workingHours;
            } else if (isWeekendDay) {
                satSunOtHours += workingHours;
            } else if (workingHours > 9) {
                weekendOtHours += workingHours - 9;
            }

            // Updated leave day calculations to include Custom Reason
            if (data.leaveReason === "Own Leave") {
                regularLeaves++;
            } else if (data.leaveReason === "Poya Day" || data.leaveReason === "Public Holiday" || data.leaveReason === "Custom Reason") {
                specialDays++;
            }

            if (isWeekendDay && (data.leaveReason === "Normal Leave Day" || data.leaveStatus === "Normal Day")) {
                weekendLeaveDays++;
            }
        }
    });
    
    // Dat Search
    const dateSearchBtn = document.getElementById('dateSearchBtn');
const dateSearchModal = document.getElementById('dateSearchModal');
const datesGrid = document.getElementById('datesGrid');

dateSearchBtn.addEventListener('click', () => {
    datesGrid.innerHTML = '';
    const daysInMonth = getDaysInMonth(currentDate.getFullYear(), currentDate.getMonth());
    
    for(let i = 1; i <= daysInMonth; i++) {
        const dateBtn = document.createElement('button');
        dateBtn.className = 'p-2 hover:bg-gray-100 rounded text-center';
        dateBtn.textContent = i;
        dateBtn.onclick = () => {
            const dayElement = document.querySelector(`[data-day="${i}"]`);
            if(dayElement) {
                dayElement.scrollIntoView({ behavior: 'smooth' });
            }
            dateSearchModal.classList.add('hidden');
        };
        datesGrid.appendChild(dateBtn);
    }
    
    dateSearchModal.classList.remove('hidden');
});

dateSearchModal.addEventListener('click', (e) => {
    if(e.target === dateSearchModal) {
        dateSearchModal.classList.add('hidden');
    }
});

    // Calculate total OT hours
    const totalOtHours = weekendOtHours + satSunOtHours + poyaPublicOtHours;

    // Update the DOM elements - Make sure all these elements exist in your HTML
    regularLeavesEl.textContent = regularLeaves;
    specialDaysEl.textContent = specialDays;
    document.getElementById("weekendLeaveDays").textContent = weekendLeaveDays; // This line is crucial
    document.getElementById("weekendOtHours").textContent = weekendOtHours.toFixed(2);
    document.getElementById("satSunOtHours").textContent = satSunOtHours.toFixed(2);
    document.getElementById("totalOtHours").textContent = totalOtHours.toFixed(2);
    document.getElementById("poyaPublicOtHours").textContent = poyaPublicOtHours.toFixed(2);
}



        // Clear All Month Data
clearAllButton.addEventListener("click", () => {
    const modal = document.getElementById("confirmationModal");
    const modalTitle = document.getElementById("modalTitle");
    const modalMessage = document.getElementById("modalMessage");
    const confirmButton = document.getElementById("confirmButton");
    const cancelButton = document.getElementById("cancelButton");

    // Set modal content for this action
    modalTitle.textContent = "Clear All Month Data";
    modalMessage.textContent =
        "Are you sure you want to clear all data for this month? This action cannot be undone.";

    // Show the modal
    modal.classList.remove("hidden");

    // Handle confirm action
    confirmButton.onclick = () => {
        const monthPrefix = `${currentDate.getFullYear()}-${currentDate.getMonth()}`;
        Object.keys(workData).forEach((key) => {
            if (key.startsWith(monthPrefix)) delete workData[key];
        });
        localStorage.setItem("workData", JSON.stringify(workData));
        calculateSummary();
        renderDays();
        modal.classList.add("hidden"); // Hide the modal after clearing
    };

    // Handle cancel action
    cancelButton.onclick = () => {
        modal.classList.add("hidden"); // Hide the modal without clearing
    };
});
        // Month Navigation
        document.getElementById("prevMonth").addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() - 1);
            populateDropdowns();
            calculateSummary();
            renderDays();
        });

        document.getElementById("nextMonth").addEventListener("click", () => {
            currentDate.setMonth(currentDate.getMonth() + 1);
            populateDropdowns();
            calculateSummary();
            renderDays();
        });

        // Dropdown Change Events
        monthDropdown.addEventListener("change", (e) => {
            currentDate.setMonth(parseInt(e.target.value));
            calculateSummary();
            renderDays();
        });

        yearDropdown.addEventListener("change", (e) => {
            currentDate.setFullYear(parseInt(e.target.value));
            calculateSummary();
            renderDays();
        });

        // Scroll Button
        const scrollUpButton = document.getElementById("scrollUpButton");
const scrollDownButton = document.getElementById("scrollDownButton");

window.addEventListener("scroll", () => {
    const isAtBottom = window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 100;
    const isAtTop = window.scrollY < 100;
    
    scrollUpButton.classList.toggle("hidden", isAtTop);
    scrollDownButton.classList.toggle("hidden", isAtBottom);
});

scrollUpButton.addEventListener("click", () => {
    window.scrollTo({ top: 0, behavior: "smooth" });
});

scrollDownButton.addEventListener("click", () => {
    window.scrollTo({ top: document.documentElement.scrollHeight, behavior: "smooth" });
});

        // Initial Render
        populateDropdowns();
        calculateSummary();
        renderDays();
    </script>
    <div id="confirmationModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-lg shadow-lg w-11/12 max-w-sm p-4">
            <div class="text-lg font-medium text-center mb-4">Are you sure?</div>
            <div class="text-sm text-gray-600 text-center mb-6">
                This action will clear all data for this day and cannot be undone.
            </div>
            <div class="flex justify-around">
                <button id="cancelButton" class="px-4 py-2 rounded bg-gray-200 text-gray-800 hover:bg-gray-300">
                    Cancel
                </button>
                <button id="confirmButton" class="px-4 py-2 rounded bg-red-500 text-white hover:bg-red-600">
                    Confirm
                </button>
            </div>
        </div>
    </div>

    <div id="confirmationModal" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-lg shadow-lg w-11/12 max-w-sm p-4">
            <div id="modalTitle" class="text-lg font-medium text-center mb-4">Are you sure?</div>
            <div id="modalMessage" class="text-sm text-gray-600 text-center mb-6">
                This action cannot be undone.
            </div>
            <div class="flex justify-around">
                <button id="cancelButton" class="px-4 py-2 rounded bg-gray-200 text-gray-800 hover:bg-gray-300">
                    Cancel
                </button>
                <button id="confirmButton" class="px-4 py-2 rounded bg-red-500 text-white hover:bg-red-600">
                    Confirm
                </button>
            </div>
        </div>
    </div>
</body>
</html>